<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®ä¼ è¾“ç»ˆç«¯ | æ•°æ®ç®±å°è£…</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', 'SF Pro Display', -apple-system, sans-serif;
            background: linear-gradient(135deg, #0a192f 0%, #302b63 50%, #24243e 100%);
            color: #e6f1ff;
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }
        
        /* ç§‘æŠ€ç½‘æ ¼èƒŒæ™¯ */
        .tech-grid {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                linear-gradient(rgba(64, 224, 208, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(64, 224, 208, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: -2;
            opacity: 0.5;
        }
        
        /* åŠ¨æ€å…‰æŸ */
        .light-beams {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(64, 224, 208, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(0, 180, 216, 0.06) 0%, transparent 50%);
            z-index: -1;
            animation: beamMove 15s ease-in-out infinite alternate;
        }
        
        @keyframes beamMove {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(50px, 30px) scale(1.1); }
        }
        
        /* ä¸»å®¹å™¨ */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 10;
        }
        
        /* å¤´éƒ¨åŒºåŸŸ */
        .header {
            text-align: center;
            margin-bottom: 60px;
            padding-bottom: 30px;
            border-bottom: 1px solid rgba(64, 224, 208, 0.2);
            position: relative;
        }
        
        .header::after {
            content: 'âŸ';
            position: absolute;
            bottom: -18px;
            left: 50%;
            transform: translateX(-50%);
            background: #0a192f;
            color: #40e0d0;
            padding: 0 25px;
            font-size: 1.8em;
            font-weight: bold;
        }
        
        .main-title {
            font-size: 3.2em;
            font-weight: 300;
            letter-spacing: 4px;
            margin-bottom: 15px;
            background: linear-gradient(90deg, #40e0d0 0%, #00b4d8 30%, #00f3ff 70%, #00b4d8 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 30px rgba(64, 224, 208, 0.3);
            background-size: 200% auto;
            animation: titleShine 3s ease-in-out infinite alternate;
        }
        
        @keyframes titleShine {
            0% { background-position: 0% center; }
            100% { background-position: 100% center; }
        }
        
        .subtitle {
            color: #8bd8ff;
            font-size: 1.1em;
            letter-spacing: 3px;
            font-weight: 300;
            text-transform: uppercase;
        }
        
        /* æ ¸å¿ƒæ•°æ®ç®±åŒºåŸŸ */
        .data-crate-container {
            background: rgba(13, 27, 42, 0.85);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(64, 224, 208, 0.15);
            border-radius: 16px;
            padding: 50px 40px;
            margin: 50px auto;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.08),
                0 0 0 1px rgba(64, 224, 208, 0.05);
        }
        
        /* æ•°æ®ç®±æœ¬ä½“ */
        .data-crate {
            width: 220px;
            height: 220px;
            margin: 40px auto;
            position: relative;
            transform-style: preserve-3d;
            animation: crateFloat 6s ease-in-out infinite;
        }
        
        @keyframes crateFloat {
            0%, 100% { transform: translateY(0) rotateX(5deg); }
            50% { transform: translateY(-15px) rotateX(5deg); }
        }
        
        .crate-face {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(0, 30, 60, 0.4);
            border: 2px solid rgba(64, 224, 208, 0.4);
            box-shadow: 
                inset 0 0 30px rgba(64, 224, 208, 0.1),
                0 0 40px rgba(64, 224, 208, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        /* å„é¢å®šä½ */
        .crate-front { transform: translateZ(110px); }
        .crate-back { transform: rotateY(180deg) translateZ(110px); }
        .crate-right { transform: rotateY(90deg) translateZ(110px); }
        .crate-left { transform: rotateY(-90deg) translateZ(110px); }
        .crate-top { transform: rotateX(90deg) translateZ(110px); }
        .crate-bottom { transform: rotateX(-90deg) translateZ(110px); }
        
        /* ç®±å†…æ•°æ®æµ */
        .data-stream {
            position: absolute;
            width: 150%;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent, 
                #40e0d0, 
                #00b4d8, 
                #40e0d0, 
                transparent);
            filter: blur(1px);
            animation: streamFlow 4s linear infinite;
            opacity: 0.7;
        }
        
        @keyframes streamFlow {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }
        
        /* ç®±ä½“è¾¹è§’ç¯å…‰ */
        .corner-light {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #40e0d0;
            border-radius: 50%;
            box-shadow: 0 0 15px #40e0d0, 0 0 30px #40e0d0;
            z-index: 10;
        }
        
        .corner-1 { top: 10px; left: 10px; }
        .corner-2 { top: 10px; right: 10px; }
        .corner-3 { bottom: 10px; left: 10px; }
        .corner-4 { bottom: 10px; right: 10px; }
        
        /* çŠ¶æ€æŒ‡ç¤º */
        .status-display {
            text-align: center;
            margin: 40px 0;
        }
        
        .status-title {
            font-size: 1.8em;
            font-weight: 300;
            color: #8bd8ff;
            margin-bottom: 25px;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(139, 216, 255, 0.3);
        }
        
        .status-message {
            font-size: 1.3em;
            color: #a8e6ff;
            min-height: 90px;
            padding: 25px;
            background: rgba(255, 79, 123, 0.68);
            border-radius: 12px;
            border: 1px solid rgba(64, 224, 208, 0.2);
            margin: 30px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.5;
        }
        
        /* è¿›åº¦è¿½è¸ªå™¨ */
        .progress-tracker {
            width: 100%;
            height: 8px;
            background: rgba(64, 224, 208, 0.1);
            border-radius: 4px;
            margin: 50px 0;
            overflow: hidden;
            position: relative;
        }
        
        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, 
                #0077b6 0%, 
                #0096c7 30%, 
                #00b4d8 60%, 
                #48cae4 90%);
            border-radius: 4px;
            position: relative;
            transition: width 0.9s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.6), 
                transparent);
            animation: progressShimmer 2s infinite;
        }
        
        @keyframes progressShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* ç³»ç»Ÿæ—¥å¿— */
        .system-log {
            background: rgba(10, 25, 47, 0.7);
            border: 1px solid rgba(64, 224, 208, 0.1);
            border-radius: 10px;
            padding: 25px;
            margin-top: 40px;
            font-family: 'Cascadia Code', 'SF Mono', monospace;
            font-size: 0.95em;
            line-height: 1.8;
            max-height: 250px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin-bottom: 12px;
            opacity: 0;
            animation: logFadeIn 0.4s forwards;
            padding-left: 10px;
            border-left: 2px solid transparent;
        }
        
        @keyframes logFadeIn { to { opacity: 1; } }
        
        .log-time { color: #48cae4; }
        .log-module { color: #00b4d8; font-weight: 500; }
        .log-message { color: #a8e6ff; }
        .log-success { color: #4cc9f0; border-left-color: #4cc9f0; }
        .log-error { color: #ff006e; border-left-color: #ff006e; }
        
        /* æ•°æ®æŒ‡æ ‡ */
        .data-metrics {
            display: flex;
            justify-content: space-around;
            margin: 40px 0;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .metric {
            background: rgba(0, 53, 102, 0.3);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            flex: 1;
            min-width: 180px;
            border: 1px solid rgba(64, 224, 208, 0.1);
        }
        
        .metric-value {
            font-size: 2.2em;
            font-weight: 300;
            color: #40e0d0;
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(64, 224, 208, 0.3);
        }
        
        .metric-label {
            color: #8bd8ff;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* åº•éƒ¨è¯´æ˜ */
        .terminal-footer {
            text-align: center;
            color: #6a9fb5;
            font-size: 0.9em;
            margin-top: 50px;
            padding-top: 25px;
            border-top: 1px solid rgba(64, 224, 208, 0.08);
            line-height: 1.7;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .container { padding: 25px 15px; }
            .main-title { font-size: 2.2em; }
            .data-crate { width: 180px; height: 180px; }
            .crate-front { transform: translateZ(90px); }
            .crate-back { transform: rotateY(180deg) translateZ(90px); }
            .crate-right { transform: rotateY(90deg) translateZ(90px); }
            .crate-left { transform: rotateY(-90deg) translateZ(90px); }
            .crate-top { transform: rotateX(90deg) translateZ(90px); }
            .crate-bottom { transform: rotateX(-90deg) translateZ(90px); }
        }
    </style>
</head>
<body>
    <!-- èƒŒæ™¯å…ƒç´  -->
    <div class="tech-grid"></div>
    <div class="light-beams"></div>
    
    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- å¤´éƒ¨åŒºåŸŸ -->
        <header class="header">
            <h1 class="main-title">æ•°æ®ç®±å°è£…åè®®</h1>
            <div class="subtitle">ç›‘æ§ç»ˆç«¯çš„æœ€ç»ˆä¼ è¾“å±‚</div>
        </header>
        
        <!-- æ ¸å¿ƒæ•°æ®ç®±åŒºåŸŸ -->
        <main class="data-crate-container">
            <!-- æ•°æ®ç®±æœ¬ä½“ -->
            <div class="data-crate" id="dataCrate">
                <!-- ç®±ä½“å…­ä¸ªé¢ -->
                <div class="crate-face crate-front">
                    <div class="data-stream" style="top: 30%; animation-delay: 0s;"></div>
                    <div class="data-stream" style="top: 70%; animation-delay: 1s;"></div>
                    <div class="corner-light corner-1"></div>
                    <div class="corner-light corner-2"></div>
                    <div class="corner-light corner-3"></div>
                    <div class="corner-light corner-4"></div>
                </div>
                <div class="crate-face crate-back">
                    <div class="data-stream" style="top: 40%; animation-delay: 0.5s;"></div>
                    <div class="data-stream" style="top: 60%; animation-delay: 1.5s;"></div>
                </div>
                <div class="crate-face crate-right">
                    <div class="data-stream" style="top: 50%; animation-delay: 0.8s;"></div>
                </div>
                <div class="crate-face crate-left">
                    <div class="data-stream" style="top: 50%; animation-delay: 1.2s;"></div>
                </div>
                <div class="crate-face crate-top"></div>
                <div class="crate-face crate-bottom"></div>
            </div>
            
            <!-- çŠ¶æ€æ˜¾ç¤º -->
            <div class="status-display">
                <h2 class="status-title">æ­£åœ¨å¯†å°æ‚¨çš„ä¸ªäººæ•°æ®ç®±</h2>
                <div class="status-message" id="statusMessage">
                    æ­£åœ¨åˆå§‹åŒ–å®‰å…¨ä¼ è¾“åè®®...
                </div>
            </div>
            
            <!-- æ•°æ®æŒ‡æ ‡ -->
            <div class="data-metrics">
                <div class="metric">
                    <div class="metric-value" id="dataSize">0.0 MB</div>
                    <div class="metric-label">æ•°æ®ä½“ç§¯</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="packetCount">0</div>
                    <div class="metric-label">æ•°æ®åŒ…</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="encryptionLevel">0%</div>
                    <div class="metric-label">åŠ å¯†å¼ºåº¦</div>
                </div>
            </div>
            
            <!-- è¿›åº¦è¿½è¸ªå™¨ -->
            <div class="progress-tracker">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            
            <!-- ç³»ç»Ÿæ—¥å¿— -->
            <div class="system-log" id="systemLog">
                <div class="log-entry">
                    <span class="log-time">[ç³»ç»Ÿå¯åŠ¨]</span>
                    <span class="log-module">æ•°æ®ç®±åè®®</span>
                    <span class="log-message">å¼€å§‹ä¸ªäººæ•°æ®å°è£…æµç¨‹...</span>
                </div>
            </div>
        </main>
        
        <!-- åº•éƒ¨è¯´æ˜ -->
        <footer class="terminal-footer">
            <div>æ•°æ®ç®±å¯†å°å®Œæˆåï¼Œå°†è‡ªåŠ¨ä¼ è¾“è‡³å±•ç¤ºç»ˆç«¯</div>
            <div style="margin-top: 8px; color: #48cae4;">è¯·æ³¨è§†å¤§å±å¹•ä»¥è§è¯æ•°æ®å•†å“åŒ–è¿‡ç¨‹</div>
        </footer>
    </div>

    <script>
        // ========== é…ç½®åŒºåŸŸ ==========
        
// ========== é…ç½®åŒºåŸŸ ==========
// è‡ªåŠ¨æ£€æµ‹æ˜¯æ–‡ä»¶åè®®è¿˜æ˜¯HTTPåè®®ï¼Œå¹¶é€‰æ‹©åˆé€‚çš„åœ°å€
function getServerConfig() {
    const protocol = window.location.protocol;
    const hostname = window.location.hostname;
    
    console.log('è°ƒè¯•ä¿¡æ¯ - é¡µé¢åè®®:', protocol);
    console.log('è°ƒè¯•ä¿¡æ¯ - é¡µé¢ä¸»æœº:', hostname);
    console.log('è°ƒè¯•ä¿¡æ¯ - å®Œæ•´URL:', window.location.href);
    
    // å¦‚æœæ˜¯æ–‡ä»¶åè®®ï¼ˆfile://ï¼‰æˆ–è€…hostnameä¸ºç©ºï¼Œä½¿ç”¨localhost
    if (protocol === 'file:' || hostname === '') {
        console.log('æ£€æµ‹åˆ°æ–‡ä»¶åè®®ï¼Œä½¿ç”¨ localhost');
        return {
            SERVER_URL: 'http://localhost:3000/trigger',
            SERVER_IP: 'localhost'
        };
    }
    // å¦‚æœæ˜¯HTTPåè®®ï¼Œä½¿ç”¨å½“å‰ä¸»æœºå
    else {
        console.log('æ£€æµ‹åˆ°HTTPåè®®ï¼Œä½¿ç”¨å½“å‰ä¸»æœºå');
        return {
            SERVER_URL: `${protocol}//${hostname}:3000/trigger`,
            SERVER_IP: hostname
        };
    }
}

// è·å–æœåŠ¡å™¨é…ç½®
const config = getServerConfig();
const SERVER_URL = config.SERVER_URL;
const SERVER_IP = config.SERVER_IP;

// è¾“å‡ºé…ç½®ä¿¡æ¯ç”¨äºè°ƒè¯•
console.log('æœåŠ¡å™¨URL:', SERVER_URL);
console.log('æœåŠ¡å™¨IP:', SERVER_IP);        
        // ========== DOM å…ƒç´  ==========
        const statusMessageEl = document.getElementById('statusMessage');
        const progressBarEl = document.getElementById('progressBar');
        const systemLogEl = document.getElementById('systemLog');
        const dataCrateEl = document.getElementById('dataCrate');
        const dataSizeEl = document.getElementById('dataSize');
        const packetCountEl = document.getElementById('packetCount');
        const encryptionLevelEl = document.getElementById('encryptionLevel');
        
        // ========== ç³»ç»Ÿæ—¥å¿—åŠŸèƒ½ ==========
        function addLogEntry(message, type = 'info') {
            const now = new Date();
            const timeString = `[${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}]`;
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            
            const typeClass = type === 'success' ? 'log-success' : type === 'error' ? 'log-error' : '';
            
            logEntry.innerHTML = `
                <span class="log-time">${timeString}</span>
                <span class="log-module">[å°è£…å¼•æ“]</span>
                <span class="log-message ${typeClass}">${message}</span>
            `;
            
            systemLogEl.appendChild(logEntry);
            systemLogEl.scrollTop = systemLogEl.scrollHeight;
        }
        
        // ========== æ›´æ–°æ•°æ®æŒ‡æ ‡ ==========
        function updateMetrics(step) {
            const metrics = {
                dataSize: (1.2 + step * 0.4).toFixed(1),
                packetCount: 42 + step * 28,
                encryptionLevel: 15 + step * 12
            };
            
            dataSizeEl.textContent = `${metrics.dataSize} MB`;
            packetCountEl.textContent = metrics.packetCount;
            encryptionLevelEl.textContent = `${Math.min(metrics.encryptionLevel, 98)}%`;
            
            // æ›´æ–°ç®±ä½“æ—‹è½¬é€Ÿåº¦ï¼ˆéšè¿›åº¦åŠ å¿«ï¼‰
            const rotationSpeed = 6 + (step * 0.5);
            dataCrateEl.style.animationDuration = `${rotationSpeed}s`;
        }
        
        // ========== å°è£…æµç¨‹åºåˆ— ==========
        const encapsulationSteps = [
            { 
                message: "æ­£åœ¨æ‰«æè¡Œä¸ºæ•°æ®æ®‹ç•™...", 
                progress: 12, 
                log: "æ‰«æå®Œæˆï¼Œå‘ç° 1.2MB ç”¨æˆ·è¡Œä¸ºæ•°æ®",
                delay: 1300 
            },
            { 
                message: "æ­£åœ¨å‹ç¼©åŸå§‹æ•°æ®åŒ…...", 
                progress: 28, 
                log: "å‹ç¼©ç‡ 63%ï¼Œç”Ÿæˆ 84 ä¸ªæ•°æ®åŒ…",
                delay: 1600 
            },
            { 
                message: "æ­£åœ¨åº”ç”¨å¤šå±‚åŠ å¯†...", 
                progress: 45, 
                log: "AES-256 åŠ å¯†å±‚å·²éƒ¨ç½²",
                delay: 1400 
            },
            { 
                message: "æ­£åœ¨ç”Ÿæˆæ•°å­—æ°´å°...", 
                progress: 62, 
                log: "æ°´å°ç¼–ç å®Œæˆï¼Œè¿½è¸ªæ ‡è¯†å·²æ¤å…¥",
                delay: 1700 
            },
            { 
                message: "æ­£åœ¨æ„å»ºæ•°æ®ç®±ç»“æ„...", 
                progress: 78, 
                log: "ç®±ä½“ç»“æ„éªŒè¯é€šè¿‡ï¼Œå‡†å¤‡å¯†å°",
                delay: 1500 
            },
            { 
                message: "æ­£åœ¨è¿æ¥å±•ç¤ºç»ˆç«¯...", 
                progress: 92, 
                log: `å®šä½åˆ°ç»ˆç«¯è®¾å¤‡ï¼š${SERVER_IP}`,
                delay: 1200 
            },
            { 
                message: "å‡†å¤‡æœ€ç»ˆä¼ è¾“...", 
                progress: 98, 
                log: "æ‰€æœ‰ç³»ç»Ÿå°±ç»ªï¼Œç­‰å¾…å‘é€æŒ‡ä»¤",
                delay: 1100 
            }
        ];
        
        // ========== æ‰§è¡Œå°è£…æµç¨‹ ==========
        async function executeEncapsulation() {
            addLogEntry("å¯åŠ¨ä¸ªäººæ•°æ®ç®±å°è£…åè®®", "success");
            addLogEntry(`ç›®æ ‡ç»ˆç«¯ï¼š${SERVER_IP}:3000`);
            
            // æŒ‰æ­¥éª¤æ‰§è¡Œå°è£…
            for (const [index, step] of encapsulationSteps.entries()) {
                // æ›´æ–°çŠ¶æ€æ¶ˆæ¯
                statusMessageEl.textContent = step.message;
                statusMessageEl.style.color = step.progress > 60 ? '#4cc9f0' : '#a8e6ff';
                
                // æ›´æ–°è¿›åº¦æ¡
                progressBarEl.style.width = `${step.progress}%`;
                
                // æ›´æ–°æ•°æ®æŒ‡æ ‡
                updateMetrics(index);
                
                // æ·»åŠ æ—¥å¿—
                addLogEntry(step.log);
                
                // ç­‰å¾…æŒ‡å®šæ—¶é—´
                await sleep(step.delay);
            }
            
            // æœ€ç»ˆè¿›åº¦åˆ°100%
            progressBarEl.style.width = '100%';
            updateMetrics(7);
            statusMessageEl.innerHTML = '<span style="color:#4cc9f0; text-shadow:0 0 10px rgba(76, 201, 240, 0.5)">âœ… æ•°æ®ç®±å¯†å°å®Œæˆï¼Œæ­£åœ¨ä¼ è¾“...</span>';
            addLogEntry("æ•°æ®ç®±å¯†å°å®Œæˆï¼Œå‡†å¤‡å‘é€è‡³å±•ç¤ºç»ˆç«¯", "success");
            
            // å‘é€æœ€ç»ˆçš„è§¦å‘è¯·æ±‚
            await sendTriggerRequest();
        }
        
// ========== å‘é€è§¦å‘è¯·æ±‚ ==========
// ========== å‘é€è§¦å‘è¯·æ±‚ ==========
async function sendTriggerRequest() {
    addLogEntry("æ­£åœ¨å‘å±•ç¤ºç»ˆç«¯å‘é€å¯åŠ¨æŒ‡ä»¤...");
    
    try {
        // å‘é€è¯·æ±‚åˆ°æœ¬åœ°æœåŠ¡å™¨
        console.log("æ­£åœ¨å‘é€POSTè¯·æ±‚åˆ°:", SERVER_URL);
        const response = await fetch(SERVER_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        // æ£€æŸ¥å“åº”çŠ¶æ€
        if (!response.ok) {
            throw new Error(`HTTPé”™è¯¯ ${response.status}: ${response.statusText}`);
        }
        
        // å°è¯•è§£æJSONå“åº”
        let result;
        try {
            result = await response.json();
            console.log("æœåŠ¡å™¨å“åº”JSON:", result);
        } catch (jsonError) {
            console.log("æœåŠ¡å™¨å“åº”ï¼ˆéJSONï¼‰:", await response.text());
            result = { status: 'ok' };
        }
        
        addLogEntry("æŒ‡ä»¤å‘é€æˆåŠŸï¼å¯åŠ¨æœ€ç»ˆå±•ç¤º...", "success");
        statusMessageEl.innerHTML = `
            <span style="color:#4cc9f0; text-shadow:0 0 15px rgba(76, 201, 240, 0.7)">
                ğŸš€ ä¼ è¾“å®Œæˆï¼<br>
                <small style="color:#a8e6ff; font-size:0.75em; display:block; margin-top:8px;">
                    æ‚¨çš„æ•°æ®ç®±å·²æŠµè¾¾å±•ç¤ºç»ˆç«¯
                </small>
            </span>
        `;
        
        // ç®±ä½“å®ŒæˆåŠ¨ç”»
        dataCrateEl.style.animation = 'none';
        setTimeout(() => {
            dataCrateEl.style.animation = 'crateFloat 4s ease-in-out infinite';
        }, 100);
        
        // æœ€ç»ˆå®Œæˆä¿¡æ¯
        setTimeout(() => {
            addLogEntry("ä¸ªäººæ•°æ®ç®±å·²å®Œæˆå•†å“åŒ–å°è£…", "success");
            addLogEntry("ç›‘æ§ç»æµç½‘ç»œå·²è®°å½•æœ¬æ¬¡äº¤æ˜“");
            
            // æ›´æ–°æœ€ç»ˆæŒ‡æ ‡
            dataSizeEl.textContent = '3.7 MB';
            packetCountEl.textContent = '247';
            encryptionLevelEl.textContent = '98%';
            
            // å»¶è¿Ÿæ˜¾ç¤ºç»“å°¾é¡µé¢
            setTimeout(showEndingPage, 2500);
        }, 1800);
        
    } catch (error) {
        console.error('è§¦å‘è¯·æ±‚å¤±è´¥:', error);
        
        // æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
        let errorMsg = error.message;
        if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
            errorMsg = `æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ ${SERVER_IP}:3000ã€‚è¯·ç¡®ä¿ï¼š<br>
                        1. æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ<br>
                        2. é˜²ç«å¢™å…è®¸3000ç«¯å£<br>
                        3. ç”µè„‘å’Œæ‰‹æœºåœ¨åŒä¸€ç½‘ç»œ`;
        }
        
        addLogEntry(`ä¼ è¾“å¤±è´¥ï¼š${errorMsg}`, "error");
        statusMessageEl.innerHTML = `
            <span style="color:#ff006e">
                âš ï¸ è¿æ¥å¤±è´¥<br>
                <small style="color:#ff4d94; font-size:0.75em; display:block; margin-top:8px; text-align:left;">
                    ${errorMsg.replace(/<br>/g, '\n')}
                </small>
            </span>
        `;
        progressBarEl.style.background = '#ff006e';
        
        // æ·»åŠ è°ƒè¯•é“¾æ¥
        const debugLink = document.createElement('a');
        debugLink.href = `http://${SERVER_IP}:3000`;
        debugLink.target = '_blank';
        debugLink.textContent = 'ç‚¹å‡»æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€';
        debugLink.style.cssText = `
            display: block;
            margin-top: 15px;
            color: #40e0d0;
            text-decoration: underline;
            cursor: pointer;
        `;
        statusMessageEl.appendChild(debugLink);
        
        // æ·»åŠ é‡è¯•æŒ‰é’®
        const retryBtn = document.createElement('button');
        retryBtn.textContent = 'é‡è¯•è¿æ¥';
        retryBtn.style.cssText = `
            background: #ff006e;
            color: white;
            border: none;
            padding: 10px 20px;
            margin-top: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-family: inherit;
        `;
        retryBtn.onclick = () => {
            retryBtn.textContent = 'é‡è¯•ä¸­...';
            setTimeout(() => {
                statusMessageEl.innerHTML = 'æ­£åœ¨é‡æ–°è¿æ¥...';
                sendTriggerRequest();
            }, 1000);
        };
        statusMessageEl.appendChild(retryBtn);
    }
}        // ========== å·¥å…·å‡½æ•° ==========
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // ========== ç»“å°¾é¡µé¢å‡½æ•° ==========
        function showEndingPage() {
            // åˆ›å»ºç»“å°¾é¡µé¢çš„æ ·å¼
            const endingStyle = document.createElement('style');
            endingStyle.textContent = `
                @keyframes pulse {
                    0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                    50% { opacity: 0.7; transform: translate(-50%, -50%) scale(1.1); }
                    100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                }
                
                @keyframes fadeInUp {
                    from {
                        opacity: 0;
                        transform: translateY(30px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
                
                @keyframes timelineStepGlow {
                    0%, 100% { box-shadow: 0 0 10px rgba(64, 224, 208, 0.3); }
                    50% { box-shadow: 0 0 20px rgba(64, 224, 208, 0.6), 0 0 40px rgba(64, 224, 208, 0.3); }
                }
                
                #endingOverlay {
                    position: fixed;
                    top: 0; left: 0;
                    width: 100%; height: 100%;
                    background: linear-gradient(135deg, #0a192f 0%, #302b63 50%, #24243e 100%);
                    z-index: 9999;
                    opacity: 0;
                    transition: opacity 1.2s ease;
                    overflow-y: auto;
                }
                
                .ending-container {
                    max-width: 800px;
                    margin: 0 auto;
                    padding: 60px 20px;
                    text-align: center;
                }
                
                .completion-badge {
                    width: 120px;
                    height: 120px;
                    margin: 40px auto 60px;
                    position: relative;
                }
                
                .timeline-step {
                    background: #0a192f;
                    padding: 15px;
                    border-radius: 50%;
                    width: 70px;
                    height: 70px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border: 2px solid #40e0d0;
                    z-index: 2;
                    position: relative;
                }
                
                .data-summary {
                    background: rgba(13, 27, 42, 0.6);
                    border-radius: 16px;
                    padding: 30px;
                    margin: 40px auto;
                    max-width: 500px;
                    border: 1px solid rgba(64, 224, 208, 0.1);
                }
                
                .ending-btn {
                    background: linear-gradient(135deg, #40e0d0 0%, #00b4d8 100%);
                    border: none;
                    color: #0a192f;
                    padding: 15px 40px;
                    font-size: 1.1em;
                    border-radius: 8px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    font-weight: 500;
                    letter-spacing: 1px;
                }
                
                .ending-btn:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 10px 20px rgba(64, 224, 208, 0.3);
                }
                
                .ending-btn-secondary {
                    background: transparent;
                    border: 1px solid rgba(64, 224, 208, 0.5);
                    color: #40e0d0;
                }
                
                .ending-btn-secondary:hover {
                    background: rgba(64, 224, 208, 0.1);
                }
            `;
            document.head.appendChild(endingStyle);
            
            // åˆ›å»ºç»“å°¾é¡µé¢HTML
            const endingOverlay = document.createElement('div');
            endingOverlay.id = 'endingOverlay';
            endingOverlay.style.display = 'none';
            
            const now = new Date();
            const timestamp = `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            endingOverlay.innerHTML = `
                <div class="tech-grid" style="position: fixed; opacity: 0.4;"></div>
                
                <div class="ending-container">
                    <!-- å®Œæˆæ ‡å¿— -->
                    <div class="completion-badge">
                        <div style="
                            position: absolute;
                            top: 0; left: 0;
                            width: 100%; height: 100%;
                            background: radial-gradient(circle, #40e0d0 0%, transparent 70%);
                            opacity: 0.3;
                            border-radius: 50%;
                        "></div>
                        <div style="
                            position: absolute;
                            top: 50%; left: 50%;
                            transform: translate(-50%, -50%);
                            font-size: 3.5em;
                            color: #40e0d0;
                            text-shadow: 0 0 30px rgba(64, 224, 208, 0.7);
                            animation: pulse 2s infinite;
                        ">âœ“</div>
                    </div>
                    
                    <!-- ä¸»æ ‡é¢˜ -->
                    <h1 style="
                        font-size: 2.8em;
                        font-weight: 300;
                        color: #e6f1ff;
                        margin-bottom: 20px;
                        letter-spacing: 3px;
                        background: linear-gradient(90deg, #40e0d0 0%, #00b4d8 50%, #00f3ff 100%);
                        -webkit-background-clip: text;
                        background-clip: text;
                        color: transparent;
                    ">æ•°æ®ç®±æ—…ç¨‹å®Œæˆ</h1>
                    
                    <!-- å‰¯æ ‡é¢˜ -->
                    <div style="
                        color: #8bd8ff;
                        font-size: 1.2em;
                        margin-bottom: 50px;
                        line-height: 1.6;
                        max-width: 600px;
                        margin-left: auto;
                        margin-right: auto;
                    ">
                        <p>æ‚¨çš„ä¸ªäººæ•°æ®å·²å®Œæˆå•†å“åŒ–å°è£…</p>
                        <p>å¹¶è¿›å…¥ç›‘æ§ç»æµç½‘ç»œæµé€š</p>
                    </div>
                    
                    <!-- æ—…ç¨‹æ—¶é—´çº¿ -->
                    <div class="journey-timeline" style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        max-width: 600px;
                        margin: 60px auto;
                        position: relative;
                    ">
                        <div style="
                            position: absolute;
                            top: 50%;
                            left: 0;
                            right: 0;
                            height: 2px;
                            background: linear-gradient(90deg, #40e0d0 0%, #00b4d8 50%, #40e0d0 100%);
                            z-index: 1;
                        "></div>
                        
                        <div class="timeline-step" data-step="1" style="border-color: #40e0d0;">
                            <div style="color: #40e0d0; font-size: 1.5em;">1</div>
                            <div style="
                                position: absolute;
                                bottom: -40px;
                                left: 50%;
                                transform: translateX(-50%);
                                white-space: nowrap;
                                color: #a8e6ff;
                                font-size: 0.9em;
                            ">æ•°æ®é‡‡é›†</div>
                        </div>
                        
                        <div class="timeline-step" data-step="2" style="border-color: #00b4d8;">
                            <div style="color: #00b4d8; font-size: 1.5em;">2</div>
                            <div style="
                                position: absolute;
                                bottom: -40px;
                                left: 50%;
                                transform: translateX(-50%);
                                white-space: nowrap;
                                color: #a8e6ff;
                                font-size: 0.9em;
                            ">å°è£…åŠ å¯†</div>
                        </div>
                        
                        <div class="timeline-step" data-step="3" style="border-color: #00f3ff;">
                            <div style="color: #00f3ff; font-size: 1.5em;">3</div>
                            <div style="
                                position: absolute;
                                bottom: -40px;
                                left: 50%;
                                transform: translateX(-50%);
                                white-space: nowrap;
                                color: #a8e6ff;
                                font-size: 0.9em;
                            ">ä¼ è¾“äº¤ä»˜</div>
                        </div>
                    </div>
                    
                    <!-- æ•°æ®æ‘˜è¦ -->
                    <div class="data-summary">
                        <h3 style="
                            color: #40e0d0;
                            margin-bottom: 25px;
                            font-weight: 300;
                            letter-spacing: 2px;
                        ">æ•°æ®ç®±æ‘˜è¦</h3>
                        
                        <div style="
                            display: flex;
                            justify-content: space-between;
                            margin-bottom: 15px;
                        ">
                            <span style="color: #8bd8ff;">æ•°æ®é‡</span>
                            <span style="color: #e6f1ff; font-weight: 500;">3.7 MB</span>
                        </div>
                        
                        <div style="
                            display: flex;
                            justify-content: space-between;
                            margin-bottom: 15px;
                        ">
                            <span style="color: #8bd8ff;">æ•°æ®åŒ…æ•°é‡</span>
                            <span style="color: #e6f1ff; font-weight: 500;">247 ä¸ª</span>
                        </div>
                        
                        <div style="
                            display: flex;
                            justify-content: space-between;
                            margin-bottom: 15px;
                        ">
                            <span style="color: #8bd8ff;">åŠ å¯†ç­‰çº§</span>
                            <span style="color: #e6f1ff; font-weight: 500;">AES-256</span>
                        </div>
                        
                        <div style="
                            display: flex;
                            justify-content: space-between;
                            margin-bottom: 15px;
                        ">
                            <span style="color: #8bd8ff;">ä¼ è¾“çŠ¶æ€</span>
                            <span style="color: #4cc9f0; font-weight: 500;">âœ“ å·²å®Œæˆ</span>
                        </div>
                        
                        <div style="
                            display: flex;
                            justify-content: space-between;
                        ">
                            <span style="color: #8bd8ff;">æ—¶é—´æˆ³</span>
                            <span style="color: #e6f1ff; font-weight: 500;">${timestamp}</span>
                        </div>
                    </div>
                    
                    <!-- åæ€è¯­å¥ -->
                    <div style="
                        background: rgba(255, 255, 255, 0.05);
                        border-left: 3px solid #40e0d0;
                        padding: 25px;
                        margin: 50px auto;
                        max-width: 600px;
                        text-align: left;
                        border-radius: 0 12px 12px 0;
                    ">
                        <div style="
                            color: #e6f1ff;
                            font-size: 1.1em;
                            line-height: 1.7;
                            font-style: italic;
                        ">
                            "æ¯ä¸€æ¬¡æ•°æ®å°è£…éƒ½æ˜¯ç›‘æ§ç»æµçš„ä¸€ç¬”äº¤æ˜“<br>
                            æ¯ä¸€æ¬¡æ•°æ®ä¼ è¾“éƒ½æ˜¯æ•°å­—èº«ä»½çš„åˆä¸€æ¬¡ç¡®è®¤"
                        </div>
                    </div>
                    
                    <!-- ç»“æŸæŒ‰é’® -->
                    <div style="
                        margin-top: 60px;
                        display: flex;
                        justify-content: center;
                        gap: 20px;
                        flex-wrap: wrap;
                    ">
                        <button id="replayBtn" class="ending-btn">
                            é‡æ–°ä½“éªŒæ—…ç¨‹
                        </button>
                        
                        <button id="closeBtn" class="ending-btn ending-btn-secondary">
                            å…³é—­é¡µé¢
                        </button>
                    </div>
                    
                    <!-- é¡µè„š -->
                    <div style="
                        margin-top: 70px;
                        color: #6a9fb5;
                        font-size: 0.9em;
                        padding-top: 30px;
                        border-top: 1px solid rgba(64, 224, 208, 0.1);
                    ">
                        <div>ç›‘æ§ç»æµç»ˆç«¯ | æ•°æ®å•†å“åŒ–åè®® v2.1</div>
                        <div style="margin-top: 10px; font-size: 0.9em;">
                            æ‚¨çš„å‚ä¸å·²è®°å½•è‡³åŒºå—é“¾è¿½è¸ªç½‘ç»œ
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(endingOverlay);
            
            // æ˜¾ç¤ºé¡µé¢
            setTimeout(() => {
                endingOverlay.style.display = 'block';
                setTimeout(() => {
                    endingOverlay.style.opacity = '1';
                    
                    // åŠ¨ç”»æ˜¾ç¤ºæ—¶é—´çº¿æ­¥éª¤
                    setTimeout(() => {
                        const steps = endingOverlay.querySelectorAll('.timeline-step');
                        steps.forEach((step, index) => {
                            setTimeout(() => {
                                step.style.animation = 'fadeInUp 0.8s ease forwards, timelineStepGlow 2s infinite';
                                step.style.opacity = '0';
                                step.style.transform = 'scale(0.9)';
                                
                                setTimeout(() => {
                                    step.style.opacity = '1';
                                    step.style.transform = 'scale(1)';
                                }, 100);
                            }, index * 400);
                        });
                    }, 500);
                }, 50);
            }, 100);
            
            // æ·»åŠ æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
            document.getElementById('replayBtn').addEventListener('click', function() {
                location.reload();
            });
            
            document.getElementById('closeBtn').addEventListener('click', function() {
                endingOverlay.style.opacity = '0';
                setTimeout(() => {
                    endingOverlay.style.display = 'none';
                    alert('æ•°æ®ç®±æ—…ç¨‹å·²ç»“æŸã€‚æ„Ÿè°¢æ‚¨çš„å‚ä¸ã€‚');
                }, 1000);
            });
        }
        
        // ========== é¡µé¢åˆå§‹åŒ– ==========
        window.addEventListener('load', function() {
            // å»¶è¿Ÿ1ç§’å¼€å§‹æµç¨‹
            setTimeout(() => {
                executeEncapsulation();
            }, 1000);
            
            // æ·»åŠ é¢å¤–çš„æ•°æ®æµ
            setTimeout(() => {
                const frontFace = document.querySelector('.crate-front');
                const newStream = document.createElement('div');
                newStream.className = 'data-stream';
                newStream.style.cssText = 'top: 50%; animation-delay: 2s;';
                frontFace.appendChild(newStream);
            }, 500);
        });
    </script></body>
</html>
